services:
  # ActiveMQ - Message broker
  activemq:
    image: apache/activemq-classic:5.18.3
    container_name: restaurant-activemq
    ports:
      - "61616:61616"
      - "8161:8161"
    environment:
      - ACTIVEMQ_ADMIN_LOGIN=admin
      - ACTIVEMQ_ADMIN_PASSWORD=admin

  # User Service
  user-service:
    build:
      context: ./userservice
      dockerfile: Dockerfile
    container_name: user-service
    ports:
      - "8081:8081"
    depends_on:
      - activemq

  # Restaurant Service
  restaurant-service:
    build:
      context: ./restarurant-service
      dockerfile: Dockerfile
    container_name: restaurant-service
    ports:
      - "8082:8082"
    depends_on:
      - activemq

  # Booking Service
  booking-service:
    build:
      context: ./booking-service
      dockerfile: Dockerfile
    container_name: booking-service
    ports:
      - "8083:8083"
    environment:
      - SPRING_ACTIVEMQ_BROKER_URL=tcp://activemq:61616
    depends_on:
      - activemq
      - user-service
      - restaurant-service

  # Frontend
  frontend:
    image: nginx:alpine
    container_name: restaurant-frontend
    ports:
      - "3000:80"
    volumes:
      - ./frontend:/usr/share/nginx/html:ro
      - ./nginx.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
      - booking-service